<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Face Recognition (OpenCV.js WebAssembly + Benchmark)</title>
<style>
  :root{
    --bg:#0f1720;
    --panel:#0b1220;
    --text:#e6eef6;
    --muted:#8fa4bf;
    --btn:#2b6cb0;
    --btn2:#334155;
    --border:#1b2b48;
  }
  *{box-sizing:border-box}
  body{
    margin:16px;
    background:var(--bg);
    color:var(--text);
    font:14px/1.55 system-ui,Segoe UI,Roboto,Arial;
  }
  .card{
    max-width:1000px;
    margin:auto;
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:14px;
    padding:16px;
    box-shadow:0 10px 24px rgba(0,0,0,.5);
  }
  h2{margin:0 0 10px}
  .muted{color:var(--muted)}
  label{display:block;margin:.5rem 0 .2rem;color:#9fb0c9}
  input,select,textarea{
    width:100%;
    padding:8px;
    border-radius:8px;
    border:1px solid #20314a;
    background:#071623;
    color:#dfeefc;
    font:13px system-ui,Segoe UI,Roboto,Arial;
  }
  textarea{resize:vertical;min-height:80px}
  button{
    padding:8px 12px;
    border:0;
    border-radius:10px;
    background:var(--btn);
    color:#fff;
    cursor:pointer;
  }
  button.secondary{background:var(--btn2)}
  button:disabled{opacity:.6;cursor:not-allowed}
  .grid{
    display:grid;
    grid-template-columns:1fr 140px 140px 220px;
    gap:10px;
  }
  .row{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    align-items:end;
  }
  #canvas{
    width:100%;
    max-width:1000px;
    border-radius:10px;
    background:#000;
    display:block;
  }
  #video{
    width:100%;
    max-width:1000px;
    border-radius:10px;
    margin:8px 0;
    display:none;
    opacity:.7;
  }
  .pill{
    display:inline-block;
    padding:4px 8px;
    border-radius:999px;
    background:#1a2a44;
    margin-left:6px;
    font-size:12px;
  }
  pre{white-space:pre-wrap}
  #benchSvg{
    width:100%;
    height:160px;
    background:#020617;
    border-radius:10px;
    margin-top:6px;
  }
</style>
</head>
<body>
  <div class="card">
    <h2>
      Face Recognition — WebAssembly
      <span class="pill">OpenCV.js 4.x (WASM)</span>
      <span class="pill">Cascade + LBP + Cosine</span>
      <span class="pill">Log 50 frame</span>
      <span class="pill">Stop on Verified</span>
    </h2>

    <!-- UI Atas -->
    <div class="grid">
      <div>
        <label>Pilih kamera</label>
        <select id="camera"></select>
        <div class="muted" style="font-size:12px">
          Jika kosong: klik Start lalu izinkan kamera.
        </div>
      </div>
      <div>
        <label>Ukuran canvas</label>
        <select id="size">
          <option value="320x240">320×240</option>
          <option value="480x360">480×360</option>
          <option value="640x480" selected>640×480</option>
        </select>
      </div>
      <div>
        <label>Process every N frames</label>
        <select id="nth">
          <option value="1">N=1</option>
          <option value="2" selected>N=2</option>
          <option value="3">N=3</option>
          <option value="4">N=4</option>
        </select>
      </div>
      <div class="row">
        <button id="start" disabled>Start</button>
        <button id="stop" class="secondary" disabled>Stop</button>
        <label style="display:flex;gap:6px;align-items:center;color:#9fb0c9">
          <input type="checkbox" id="showVideo"> preview video
        </label>
      </div>
    </div>

    <!-- UI Enroll -->
    <div class="row" style="margin-top:10px">
      <div>
        <label>Nama untuk enroll</label>
        <input id="name" placeholder="mis: Sismadi">
      </div>
      <div>
        <label>Sample</label>
        <select id="samples">
          <option>10</option>
          <option>15</option>
          <option selected>20</option>
          <option>30</option>
        </select>
      </div>
      <div>
        <label>Threshold cosine</label>
        <input id="th" value="0.90">
      </div>
      <div class="row">
        <button id="enroll" class="secondary" disabled>Enroll</button>
        <button id="clearDb" class="secondary">Clear DB</button>
        <button id="exportDb" class="secondary">Export</button>
        <label class="secondary" style="padding:8px 12px;border-radius:10px;cursor:pointer;display:inline-flex;align-items:center;gap:6px;background:#334155">
          Import
          <input id="importDb" type="file" accept="application/json" style="display:none">
        </label>
      </div>
    </div>

    <p class="muted" id="status">
      Status: memuat OpenCV.js (WebAssembly)…  
    </p>

    <video id="video" playsinline autoplay muted></video>
    <canvas id="canvas" width="640" height="480"></canvas>

    <!-- Benchmark -->
    <div style="margin-top:12px">
      <label>Benchmark log (ms per processed frame) — maksimal 50 data</label>
      <textarea id="bench"></textarea>
      <div class="row" style="margin-top:6px;align-items:center">
        <span id="benchInfo" class="muted" style="flex:1 1 auto;font-size:12px">
          Belum ada data benchmark.
        </span>
        <button id="renderChart" class="secondary">Render Chart</button>
        <button id="clearBench" class="secondary">Clear Log</button>
      </div>
      <svg id="benchSvg"></svg>
    </div>

    <p class="muted" style="margin-top:8px">
      Versi WASM identik dengan baseline asm.js, hanya backend berbeda.
    </p>

    <pre id="log" class="muted"></pre>
  </div>

  <!-- OpenCV.js -->
  <script async src="https://docs.opencv.org/4.x/opencv.js"
          onload="onOpenCvReady()"></script>

  <!-- JS akan dikirim pada BAGIAN 2 & 3 -->
  <script>
